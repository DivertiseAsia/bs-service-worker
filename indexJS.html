<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Divertise bs-service-worker Example</title>
</head>
<body>
  <script>
    // stub a variable ReactJS checks. ReactJS assumes you're using a bundler, NodeJS or similar system that provides it the `process.env.NODE_ENV` variable.
    window.process = {
      env: {
        NODE_ENV: 'development'
      }
    };
  </script>
  <div id="demo">
    <div>
      <h1>hello service worker!</h1>
      <a href="features.html">See Features</a>
      <h2>Your Browser:</h2>
      <table>
        <tbody>
          <tr><td>Supports ServiceWorker?</td><td><span id="supported">❌</span></td></tr>
          <tr><td>Registered ServiceWorker now?</td><td><span id="registerSuccess">❌</span></td></tr>
          <tr><td>Registering Nonexistant ServiceWorker fails?</td><td><span id="failureSuccess">❌</span></td></tr>
          <tr>
            <td>Unregister works? <button id="unregister" style="display:none;" onClick="unregisterServiceWorker()">unregister</button></td>
            <td><span id="unregisterSuccess">❌</span></td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
  <script type="text/javascript">
    serviceWorkerRegistration = null;
    function helperMarkAsSuccess(id) {
      document.getElementById(id).textContent = "✔";
    }
    function unregisterServiceWorker() {
      if (serviceWorkerRegistration) {
        serviceWorkerRegistration.unregister().then(function(success) {
          if (success === true) {
            console.log('[App] ServiceWorker unregister success');
            document.getElementById("unregister").style = "display: none;";
            helperMarkAsSuccess("unregisterSuccess");
          } else {
            console.log('[App] ServiceWorker unregister failed');
          }
        })
      } else {
        console.log("[App] No ServiceWorker to unregister");
      }
    }
    if ('serviceWorker' in navigator) {
      console.log("[App] Browser supports service workers");
      helperMarkAsSuccess("supported");
      window.addEventListener('load', function() {
        navigator.serviceWorker.register('demo-sw.js').then(function(registration) {
          console.log('[App] ServiceWorker registration successful with scope: ', registration.scope);
          serviceWorkerRegistration = registration;
          document.getElementById("unregister").style = "";
          helperMarkAsSuccess("registerSuccess");
        }, function(err) {
          console.log('[App] ServiceWorker registration failed: ', err);
        });
        navigator.serviceWorker.register('nonexistant-sw.js').then(function(registration) {
        }, function(err) {
          console.log('[App] ServiceWorker registration failed (expected): ', err);
          helperMarkAsSuccess("failureSuccess");
        });
      });
    } else {
      console.log("[App] Browser does *not* support service workers");
    }
  </script>
</body>
</html>
